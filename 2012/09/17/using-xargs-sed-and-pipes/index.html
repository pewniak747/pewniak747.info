<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta content='IE=edge;chrome=1' http-equiv='X-UA-Compatible'>
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<link href='/feed.xml' rel='alternate' title="Tomasz Pewiński's blog" type='application/rss+xml'>
<link href='/favicon.ico' rel='shortcut icon'>
<link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
<link href='/stylesheets/syntax.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/style.css' rel='stylesheet' type='text/css'>
<title>Using xargs, sed and pipes | Tomasz Pewiński</title>
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-27002819-3']);
  _gaq.push(['_trackPageview']);
  
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>
<body>
<header class='header--collapsed'>
<div class='container'>
<a href='/'>
<h1>Tomasz Pewinski</h1>
</a>
<nav>
<ul>
<li>
<a href='/about'>about me</a>
</li>
<li>
<a href='/feed.xml'>rss</a>
</li>
<li>
<a href='https://twitter.com/pewniak747' target='_blank'>twitter</a>
</li>
<li>
<a href='https://github.com/pewniak747' target='_blank'>github</a>
</li>
<li>
<a href='https://linkedin.com/pub/tomasz-pewiński/70/955/94' target='_blank'>linkedin</a>
</li>
</ul>
</nav>
</div>
</header>
<section class='container'>
<article>
<section class='heading'>
<h1 class='title'>
<a href='/2012/09/17/using-xargs-sed-and-pipes/'>Using xargs, sed and pipes</a>
</h1>
<time class='date' pubdate=''>17 Sep 2012</time>
</section>
<section class='content'><h2>Problem</h2>

<p>Upon migrating my blog to new engine, I had to rename bunch of article files.</p>

<p>As is: <code>source/2012/09/17/Using-xargs-and-sed.markdown</code></p>

<p>Should be: <code>source/2012-09-17-using-xargs-and-sed.markdown</code></p>

<p>So basically to move files from nested directories into <code>source</code> directory, downcasing and adding a prefix of year-month-day.</p>

<h2>Solution</h2>

<p>Combination of <code>find</code>, <code>xargs</code>, <code>tr</code> and <code>sed</code>:</p>
<pre class="highlight shell"><code>find <span class="nb">source</span>/20??/<span class="k">**</span>/<span class="k">*</span>.markdown |
xargs -n1 sh -c <span class="s1">'echo $0 &amp;&amp; echo $0 | tr "[:upper:]" "[:lower:]" | sed -e s/\\//-/g -e s/^source-/source\\//'</span> |
xargs -n2 mv
</code></pre>
<p>In the first line, we list all article files, using wildcards.</p>

<p>Then we&rsquo;re piping the output to <code>xargs</code> with <code>-n1</code> switch, and a command. This will invoke the command for every (<code>-n1</code>) line passing it as argument. The trick is, command to invoke is actually a new shell process with its own instructions passed after <code>-c</code> switch!</p>

<p>In the subshell, we first print the original path (<code>$0</code>, because it was the argumant passed to the shell). Then the path is processed:</p>

<ul>
<li><code>tr &quot;[:upper:]&quot; &quot;[:lower:]&quot;</code> converts it to lower-case letters</li>
<li>we&rsquo;re using sed with two <code>-e</code> switches:

<ul>
<li><code>s/\\//-/g</code> - replaces every occurence of <code>/</code> for <code>-</code>. I had to use <code>\\/</code> because it is interpolated to string, being an argument to <code>sh -c</code> command.</li>
<li><code>s/^source-/source\\//</code> - restore first slash after <code>source</code></li>
</ul></li>
<li>no more pipes so processed path is printed to stdout.</li>
</ul>

<p>Now we have multiple lines of paths, original, then processed and so on:</p>
<pre class="highlight plaintext"><code>source/2012/09/17/Using-xargs-and-sed.markdown
source/2012-09-17-using-xargs-and-sed.markdown
source/2012/08/04/Checker-gem-for-ruby-rails-development.markdown
source/2012-08-04-checker-gem-for-ruby-rails-development.markdown
</code></pre>
<p>Piping that to <code>xargs -n2 mv</code> will invoke <code>mv</code> passing consecutive pairs of lines, which is just what we wanted!</p>
<pre class="highlight plaintext"><code>mv source/2012/09/17/Using-xargs-and-sed.markdown source/2012-09-17-using-xargs-and-sed.markdown
</code></pre>
<p>Have a better / more obvious solution? Let me know in the comments. Meanwhile, &lt;3 UNIX.</p>
</section>
<section class='comments'><div id='disqus_thread'></div>
<script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'pewniak747-info'; // required: replace example with your forum shortname
  
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>
Please enable JavaScript to view the
<a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a>
</noscript>
<a class='dsq-brlink' href='http://disqus.com'>
comments powered by
<span class='logo-disqus'>Disqus</span>
</a>
</section>
</article>

</section>
</body>
</html>
